<div id="dataviz">
  <script src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>
  <script src="
https://cdn.jsdelivr.net/npm/slugify@1.6.6/slugify.min.js
"></script>
  <script src="https://raw.githack.com/viniciusofp/datacenter-municipios-intercept/refs/heads/main/data.js"></script>
  <link href="./style.css" rel="stylesheet" />
  <script type="module">
    import { createApp } from 'https://unpkg.com/petite-vue?module';
    const parsedMunicipios = municipios.map((m) => ({
      id: m[0],
      nome: m[1],
      uf: m[2],
      populacao: m[3]
    }));
    createApp({
      municipiosData: parsedMunicipios,
      filteredMunicipios: _.orderBy(parsedMunicipios, ['populacao'], ['desc']),
      showList: true,
      input: '',
      selectedMunicipio: null,
      update: _.debounce(function (e) {
        if (e.target.value) {
          this.filterMunicipios(e.target.value);
        } else {
          this.filteredMunicipios = _.orderBy(
            parsedMunicipios,
            ['populacao'],
            ['desc']
          );
        }
        this.input = e.target.value;
        this.scrollListToTop();
      }, 100),
      scrollListToTop() {
        let el = document.getElementById('municipiosList');
        el.scrollTop = 0;
      },
      filterMunicipios(value) {
        const filter = this.municipiosData.filter((mun) => {
          return (
            slugify(mun.nome, { lower: true, replacement: '' }) +
            slugify(mun.uf, { lower: true, replacement: '' })
          ).includes(slugify(value, { lower: true, replacement: '' }));
        });
        this.filteredMunicipios = _.orderBy(filter, ['populacao'], ['desc']);
      },
      formatNumber(value) {
        if (parseInt(value) >= 1e6) {
          return `${Math.floor(parseInt(value) / 1e6)} ${
            Math.floor(parseInt(value) / 1e6) > 1 ? 'milhões' : 'milhão'
          } e ${Math.floor(parseInt(value % 1e6) / 1e3)} mil`;
        }
        if (parseInt(value) > 1e3) {
          return (parseInt(value) / 1e3).toFixed(0) + ' mil';
        }
        return parseInt(value).toLocaleString();
      },
      setShowList: function () {
        this.showList = true;
      },
      selectMunicipio(value) {
        this.input = `${value.nome} - ${value.uf}`;
        this.selectedMunicipio = value;
        this.showList = false;
      },
      posicaoMunicipio() {
        let posicao = _.indexOf(
          _.orderBy(this.municipiosData, ['populacao'], ['desc']),
          this.selectedMunicipio
        );
        if (posicao <= 19) {
          return `, que é a ${ordinais[posicao]} cidade com maior população no Brasil`;
        }

        let posicaoNoEstado = _.indexOf(
          _.orderBy(
            this.municipiosData.filter(
              (m) => m.uf === this.selectedMunicipio.uf
            ),
            ['populacao'],
            ['desc']
          ),
          this.selectedMunicipio
        );
        if (posicaoNoEstado <= 9) {
          return `, que é a ${
            ordinais[posicaoNoEstado]
          } cidade com maior população do estado ${
            ufs[this.selectedMunicipio.uf][1]
          } ${ufs[this.selectedMunicipio.uf][0]}`;
        }
        return null;
      },
      ratio() {
        if (this.selectedMunicipio) {
          return (
            consumoAnualDC /
            (ufs[this.selectedMunicipio.uf][2] *
              this.selectedMunicipio.populacao)
          );
        }
        return 0;
      },
      timeSpent() {
        const totalDays = Math.round(360 * this.ratio());
        const yearsSpent = Math.floor(totalDays / 360);
        const monthsSpent = Math.floor((totalDays % 360) / 30);
        const daysSpent = totalDays % 30;
        return { yearsSpent, monthsSpent, daysSpent };
      },
      random() {
        this.selectedMunicipio = _.sample(parsedMunicipios);
        this.input = '';
        this.filteredMunicipios = _.orderBy(
          parsedMunicipios,
          ['populacao'],
          ['desc']
        );
        this.showList = false;
      }
    }).mount('#dataviz');
  </script>
  <div
    class="tib-border-8 tib-border-[#6653ff] tib-max-w-2xl tib-mx-auto tib-my-8 tib-mb-12 tib-px-6 md:tib-px-8 tib-pt-8 tib-pb-12 tib-text-lg md:tib-text-[20px]"
  >
    <p
      class="tib-mb-8 tib-font-bold tib-text-2xl md:tib-text-3xl tib-font-actu"
    >
      Quanto tempo sua cidade levaria para consumir a energia que o data center
      do TikTok consome em um ano??
    </p>

    <!-- Input -->

    <p class="tib-mb-4" v-if="showList && filteredMunicipios !== null">
      Insira uma cidade na busca abaixo e confira.
    </p>
    <div class="tib-relative" v-if="showList && filteredMunicipios !== null">
      <svg
        data-v-3bab6120=""
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="lucide lucide-search-icon lucide-search tib-search-icon tib-opacity-50 tib-absolute tib-left-3 tib-top-5 tib-w-6 tib-h-6"
      >
        <path d="m21 21-4.34-4.34"></path>
        <circle cx="11" cy="11" r="8"></circle>
      </svg>
      <input
        type="text"
        class="tib-border-2 tib-border-[#111] tib-h-16 tib-px-3 tib-pl-12 tib-flex tib-items-center tib-w-full tib-leading-0 tib-font-actu-mono tib-text-base focus:tib-ring-black focus:tib-outline-[#6653ff]"
        :value="input"
        @input="update"
        @focus="setShowList"
        placeholder="Digite o nome da sua cidade"
      />

      <!-- Lista de municípios -->
      <ul
        id="municipiosList"
        class="tib-bg-white tib-border-2 tib-border-[#111] tib-border-t-0 tib-max-h-48 tib-w-full tib-overflow-y-auto tib-left-0"
      >
        <li
          v-for="item in filteredMunicipios.slice(0,50)"
          :key="item.id"
          class="tib-hover:bg-neutral-200 tib-py-2 tib-px-4 tib-cursor-pointer tib-tracking-wide tib-duration-150 tib-text-base tib-font-actu-mono"
          @click="selectMunicipio(item)"
          :class="{'tib-text-[#6653ff]': selectedMunicipio.id === item.id}"
        >
          {{ item.nome }} - {{item.uf}}
        </li>
      </ul>
    </div>
    <div class="tib-grid sm:tib-flex tib-gap-3 tib-items-center tib-mt-8">
      <button
        class="tib-uppercase tib-font-actu-mono tib-text-sm tib-font-bold tib-tracking-wider tib-text-[#6653ff] tib-border-[#6653ff] tib-border-2 tib-px-4 tib-h-12 tib-flex tib-items-center tib-justify-center tib-cursor-pointer tib-hover:bg-[#6653ff] tib-hover:text-white tib-duration-150 tib-gap-2"
        @click="setShowList"
        v-if="!showList"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-search-icon lucide-search tib-w-4 tib-h-4"
        >
          <path d="m21 21-4.34-4.34" />
          <circle cx="11" cy="11" r="8" />
        </svg>
        Escolher cidade
      </button>
      <button
        class="tib-uppercase tib-font-actu-mono tib-text-sm tib-font-bold tib-tracking-wider tib-text-gray-500 tib-border-gray-500 tib-border-2 tib-px-4 tib-h-12 tib-flex tib-items-center tib-justify-center tib-cursor-pointer tib-hover:bg-gray-500 tib-hover:text-white tib-duration-150 tib-gap-2"
        @click="random"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="lucide lucide-shuffle-icon lucide-shuffle tib-w-4 tib-h-4"
        >
          <path d="m18 14 4 4-4 4" />
          <path d="m18 2 4 4-4 4" />
          <path
            d="M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22"
          />
          <path d="M2 6h1.972a4 4 0 0 1 3.6 2.2" />
          <path d="M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45" />
        </svg>
        Cidade aleatória
      </button>
    </div>
    <!-- Município -->
    <article v-if="selectedMunicipio !== null" class="tib-mt-8">
      <!-- Título -->
      <h2
        class="tib-font-bold tib-font-actu tib-text-[#111] tib-text-2xl md:tib-text-3xl tib-mb-3 md:tib-mb-5 tib-grid md:tib-flex tib-items-center tib-gap-4"
      >
        <span class="tib-h-[10px] tib-w-[70px] tib-bg-[#111]"></span
        ><span
          >{{selectedMunicipio.nome}}
          <span class="tib-font-normal"
            >- {{ufs[selectedMunicipio.uf][0]}}</span
          ></span
        >
      </h2>
      <!-- Descrição -->
      <p class="tib-mb-5">
        O consumo de energia previsto para o data center do TikTok corresponde a
        <strong>{{Math.round(ratio() * 100)}}%</strong> do
        <strong
          >consumo dos {{formatNumber(selectedMunicipio.populacao)}} habitantes
          da cidade de {{selectedMunicipio.nome}}</strong
        >{{posicaoMunicipio()}}.
      </p>
      <p class="tib-mb-5">
        Isso significa que o data center consumiria em um ano o mesmo que toda a
        população de {{selectedMunicipio.nome}} consome em:
      </p>
      <div
        class="tib-grid tib-grid-cols-3 tib-border-2 tib-border-[#111] tib-text-[#111]"
      >
        <div
          class="tib-relative tib-aspect-square tib-border-r-2 tib-border-[#111] tib-flex tib-items-center tib-justify-center"
        >
          <div class="tib-grid tib-justify-center tib-text-center">
            <p
              class="tib-text-5xl sm:tib-text-7xl tib-font-actu-mono tib-font-extrabold tib-mb-4"
              :class="{'tib-text-[#111]/20': timeSpent().yearsSpent === 0}"
            >
              {{timeSpent().yearsSpent}}
            </p>
          </div>
          <p
            class="tib-uppercase tib-font-actu-mono tib-text-xs md:tib-text-base tib-font-bold tib-tracking-widest tib-w-full tib-border-t tib-py-1.5 md:tib-py-2 tib-absolute tib-bottom-0 tib-left-0 tib-text-center"
          >
            {{timeSpent().yearsSpent === 1 ? 'ano' : 'anos'}}
          </p>
        </div>
        <div
          class="tib-relative tib-aspect-square tib-border-r-2 tib-border-[#111] tib-flex tib-items-center tib-justify-center"
        >
          <div class="tib-grid tib-justify-center tib-text-center">
            <p
              class="tib-text-5xl sm:tib-text-7xl tib-font-actu-mono tib-font-extrabold tib-mb-4"
              :class="{'tib-text-[#111]/20': timeSpent().monthsSpent === 0}"
            >
              {{timeSpent().monthsSpent}}
            </p>
          </div>
          <p
            class="tib-uppercase tib-font-actu-mono tib-text-xs md:tib-text-base tib-font-bold tib-tracking-widest tib-w-full tib-border-t tib-py-1.5 md:tib-py-2 tib-absolute tib-bottom-0 tib-left-0 tib-text-center"
          >
            {{timeSpent().monthsSpent === 1 ? 'mês' : 'meses'}}
          </p>
        </div>
        <div
          class="tib-relative tib-aspect-square tib-flex tib-items-center tib-justify-center"
        >
          <div class="tib-grid tib-justify-center tib-text-center">
            <p
              class="tib-text-5xl sm:tib-text-7xl tib-font-actu-mono tib-font-extrabold tib-mb-4"
              :class="{'tib-text-[#111]/20': timeSpent().daysSpent === 0}"
            >
              {{timeSpent().daysSpent}}
            </p>
          </div>
          <p
            class="tib-uppercase tib-font-actu-mono tib-text-xs md:tib-text-base tib-font-bold tib-tracking-widest tib-w-full tib-border-t tib-py-1.5 md:tib-py-2 tib-absolute tib-bottom-0 tib-left-0 tib-text-center"
          >
            {{timeSpent().daysSpent === 1 ? 'dia' : 'dias'}}
          </p>
        </div>
      </div>
      <p
        class="tib-text-gray-500 tib-font-actu-mono tib-text-sm tib-mb-3 tib-mt-8"
      >
        Como o Anuário Estatístico de Energia Elétrica não informa o consumo
        residencial por município, a estimativa para cada cidade foi feita com
        base no consumo residencial anual per capita médio da respectiva unidade
        da federação em 2024, multiplicado pela população local. Esse valor foi
        então comparado ao consumo anual previsto para o data center, conforme
        estimativa apresentada pela empresa no estudo para obtenção da licença
        prévia.
      </p>
      <p class="tib-text-gray-500 tib-font-actu-mono tib-text-sm">
        Fontes:
        <a
          href="https://www.epe.gov.br/pt/publicacoes-dados-abertos/publicacoes/anuario-estatistico-de-energia-eletrica"
          target="_blank"
          rel="noopener noreferrer"
          class="tib-underline tib-hover:text-gray-800"
          >Anuário Estatístico de Energia Elétrica 2025 (EPE)</a
        >;
        <a
          href="https://censo2022.ibge.gov.br/panorama/"
          target="_blank"
          rel="noopener noreferrer"
          class="tib-underline tib-hover:text-gray-800"
          >Censo Demográfico 2022 (IBGE)</a
        >.
      </p>
    </article>
  </div>

  <style>
    /* Colar aqui os estilos */
  </style>
</div>
