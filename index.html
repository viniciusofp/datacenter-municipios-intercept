<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="dataviz" class="text-lg md:text-[20px]">
      <script src="https://unpkg.com/lodash@4.17.21/lodash.min.js"></script>
      <script src="
https://cdn.jsdelivr.net/npm/slugify@1.6.6/slugify.min.js
"></script>
      <script src="https://raw.githack.com/viniciusofp/datacenter-municipios-intercept/refs/heads/main/data.js"></script>
      <link href="./style.css" rel="stylesheet" />
      <link rel="preconnect" href="https://fonts.googleapis.com" />
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
      <link
        href="https://fonts.googleapis.com/css2?family=Newsreader:ital,opsz,wght@0,6..72,200..800;1,6..72,200..800&display=swap"
        rel="stylesheet"
      />

      <script type="module">
        import { createApp } from 'https://unpkg.com/petite-vue?module';
        const parsedMunicipios = municipios.map((m) => ({
          id: m[0],
          nome: m[1],
          uf: m[2],
          populacao: m[3]
        }));
        createApp({
          municipiosData: parsedMunicipios,
          filteredMunicipios: _.orderBy(
            parsedMunicipios,
            ['populacao'],
            ['desc']
          ),
          showList: true,
          input: '',
          selectedMunicipio: null,
          update: _.debounce(function (e) {
            if (e.target.value) {
              this.filterMunicipios(e.target.value);
            } else {
              this.filteredMunicipios = _.orderBy(
                parsedMunicipios,
                ['populacao'],
                ['desc']
              );
            }
            this.input = e.target.value;
            this.scrollListToTop();
          }, 100),
          scrollListToTop() {
            let el = document.getElementById('municipiosList');
            el.scrollTop = 0;
          },
          filterMunicipios(value) {
            const filter = this.municipiosData.filter((mun) => {
              return (
                slugify(mun.nome, { lower: true, replacement: '' }) +
                slugify(mun.uf, { lower: true, replacement: '' })
              ).includes(slugify(value, { lower: true, replacement: '' }));
            });
            this.filteredMunicipios = _.orderBy(
              filter,
              ['populacao'],
              ['desc']
            );
          },
          formatNumber(value) {
            if (parseInt(value) >= 1e6) {
              return `${Math.floor(parseInt(value) / 1e6)} ${
                Math.floor(parseInt(value) / 1e6) > 1 ? 'milhões' : 'milhão'
              } e ${Math.floor(parseInt(value % 1e6) / 1e3)} mil`;
            }
            if (parseInt(value) > 1e3) {
              return (parseInt(value) / 1e3).toFixed(0) + ' mil';
            }
            return parseInt(value).toLocaleString();
          },
          setShowList: function () {
            this.showList = true;
          },
          selectMunicipio(value) {
            this.input = `${value.nome} - ${value.uf}`;
            this.selectedMunicipio = value;
            this.showList = false;
          },
          posicaoMunicipio(mun) {
            let posicao = _.indexOf(
              _.orderBy(this.municipiosData, ['populacao'], ['desc']),
              mun
            );
            if (posicao <= 19) {
              return `é a ${ordinais[posicao]} cidade com maior população no Brasil`;
            }

            let posicaoNoEstado = _.indexOf(
              _.orderBy(
                this.municipiosData.filter((m) => m.uf === mun.uf),
                ['populacao'],
                ['desc']
              ),
              mun
            );
            if (posicaoNoEstado <= 9) {
              return `é a ${
                ordinais[posicaoNoEstado]
              } cidade com maior população do estado ${ufs[mun.uf][1]} ${
                ufs[mun.uf][0]
              }`;
            }
            return `é considerada uma cidade ${
              parseInt(this.selectedMunicipio.populacao) > 499999
                ? 'grande'
                : parseInt(this.selectedMunicipio.populacao) > 99999
                ? 'média'
                : 'pequena'
            }`;
          },
          ratio() {
            if (this.selectedMunicipio) {
              return (
                consumoAnualDC /
                (ufs[this.selectedMunicipio.uf][2] *
                  this.selectedMunicipio.populacao)
              );
            }
            return 0;
          },
          timeSpent() {
            const totalDays = Math.round(360 * this.ratio());
            const yearsSpent = Math.floor(totalDays / 360);
            const monthsSpent = Math.floor((totalDays % 360) / 30);
            const daysSpent = totalDays % 30;
            return { yearsSpent, monthsSpent, daysSpent };
          },
          totalEstado(mun) {
            return this.formatNumber(
              _.sum(
                this.municipiosData
                  .filter((m) => m.uf === mun.uf)
                  .map((m) => m.populacao)
              )
            );
          }
        }).mount('#dataviz');
      </script>

      <div
        class="border-8 border-[#6653ff] max-w-2xl mx-auto my-8 mb-12 px-6 md:px-8 pt-8 pb-12"
      >
        <p class="mb-8 font-bold text-2xl md:text-3xl font-actu">
          Quanto tempo sua cidade levaria para consumir a energia que o data
          center do TikTok consome em um ano??
        </p>

        <!-- Input -->
        <button
          class="uppercase font-actu-mono text-sm font-bold tracking-wider text-[#6653ff] border-[#6653ff] border-2 px-4 pt-2.5 pb-2 cursor-pointer hover:bg-[#6653ff] hover:text-white duration-150"
          @click="setShowList"
          v-if="!showList"
        >
          Escolher outra cidade
        </button>
        <p class="mb-4" v-if="showList && filteredMunicipios !== null">
          Insira uma cidade na busca abaixo e confira.
        </p>
        <div class="relative" v-if="showList && filteredMunicipios !== null">
          <svg
            data-v-3bab6120=""
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="lucide lucide-search-icon lucide-search search-icon opacity-50 absolute left-3 top-5 w-6 h-6"
          >
            <path d="m21 21-4.34-4.34"></path>
            <circle cx="11" cy="11" r="8"></circle>
          </svg>
          <input
            type="text"
            class="border-2 border-[#111] h-16 px-3 pl-12 flex items-center w-full leading-0 font-actu-mono text-base focus:ring-black focus:outline-[#6653ff]"
            :value="input"
            @input="update"
            @focus="setShowList"
            placeholder="Digite o nome da sua cidade"
          />

          <!-- Lista de municípios -->
          <ul
            id="municipiosList"
            class="bg-white border-2 border-[#111] border-t-0 shadow-md sm:shadow-lg max-h-42 w-full overflow-y-auto left-0"
          >
            <li
              v-for="item in filteredMunicipios.slice(0,50)"
              :key="item.id"
              class="hover:bg-neutral-200 py-2 px-4 cursor-pointer tracking-wide duration-150 text-base font-actu-mono"
              @click="selectMunicipio(item)"
              :class="{'text-[#6653ff]': selectedMunicipio.id === item.id}"
            >
              {{ item.nome }} - {{item.uf}}
            </li>
          </ul>
        </div>

        <!-- Município -->
        <article v-if="selectedMunicipio !== null" class="mt-8">
          <!-- Título -->
          <h2
            class="font-bold font-actu text-[#111] text-2xl md:text-3xl mb-3 md:mb-5 grid md:flex items-center gap-4"
          >
            <span class="h-[10px] w-[70px] bg-[#111]"></span
            ><span
              >{{selectedMunicipio.nome}}
              <span class="font-normal"
                >- {{ufs[selectedMunicipio.uf][0]}}</span
              ></span
            >
          </h2>
          <!-- Descrição -->
          <p class="mb-5">
            O consumo de energia previsto para o data center do TikTok
            corresponde a <strong>{{Math.round(ratio() * 100)}}%</strong> do
            <strong
              >consumo dos {{formatNumber(selectedMunicipio.populacao)}}
              habitantes da cidade de {{selectedMunicipio.nome}}</strong
            >.
          </p>
          <p class="mb-5">
            Isso significa que o data center consumiria em um ano o mesmo que
            toda a população de {{selectedMunicipio.nome}} consome em:
          </p>
          <div class="grid grid-cols-3 border-2 border-[#111] text-[#111]">
            <div
              class="relative aspect-square border-r-2 border-[#111] flex items-center justify-center"
              :class="{'text-[#111]/20': timeSpent().yearsSpent === 0}"
            >
              <div class="grid justify-center text-center">
                <p
                  class="text-5xl sm:text-7xl font-actu-mono font-extrabold mb-4"
                >
                  {{timeSpent().yearsSpent}}
                </p>
              </div>
              <p
                class="uppercase font-actu-mono text-xs md:text-base font-bold tracking-widest w-full border-t py-1 md:py-2 absolute bottom-0 left-0 text-center"
              >
                {{timeSpent().yearsSpent === 1 ? 'ano' : 'anos'}}
              </p>
            </div>
            <div
              class="relative aspect-square border-r-2 border-[#111] flex items-center justify-center"
              :class="{'text-[#111]/20': timeSpent().monthsSpent === 0}"
            >
              <div class="grid justify-center text-center">
                <p
                  class="text-5xl sm:text-7xl font-actu-mono font-extrabold mb-4"
                >
                  {{timeSpent().monthsSpent}}
                </p>
              </div>
              <p
                class="uppercase font-actu-mono text-xs md:text-base font-bold tracking-widest w-full border-t py-1 md:py-2 absolute bottom-0 left-0 text-center"
              >
                {{timeSpent().monthsSpent === 1 ? 'mês' : 'meses'}}
              </p>
            </div>
            <div
              class="relative aspect-square flex items-center justify-center"
              :class="{'text-[#111]/20': timeSpent().daysSpent === 0}"
            >
              <div class="grid justify-center text-center">
                <p
                  class="text-5xl sm:text-7xl font-actu-mono font-extrabold mb-4"
                >
                  {{timeSpent().daysSpent}}
                </p>
              </div>
              <p
                class="uppercase font-actu-mono text-xs md:text-base font-bold tracking-widest w-full border-t py-1 md:py-2 absolute bottom-0 left-0 text-center"
              >
                {{timeSpent().daysSpent === 1 ? 'dia' : 'dias'}}
              </p>
            </div>
          </div>
          <p class="text-gray-500 font-actu-mono text-sm mb-3 mt-8">
            Como o Anuário Estatístico de Energia Elétrica não informa o consumo
            residencial por município, a estimativa para cada cidade foi feita
            com base no consumo residencial anual per capita médio da respectiva
            unidade da federação em 2024, multiplicado pela população local.
            Esse valor foi então comparado ao consumo anual previsto para o data
            center, conforme estimativa apresentada pela empresa no estudo para
            obtenção da licença prévia.
          </p>
          <p class="text-gray-500 font-actu-mono text-sm">
            Fontes:
            <a
              href="https://www.epe.gov.br/pt/publicacoes-dados-abertos/publicacoes/anuario-estatistico-de-energia-eletrica"
              target="_blank"
              rel="noopener noreferrer"
              class="underline hover:text-gray-800"
              >Anuário Estatístico de Energia Elétrica 2025 (EPE)</a
            >;
            <a
              href="https://censo2022.ibge.gov.br/panorama/"
              target="_blank"
              rel="noopener noreferrer"
              class="underline hover:text-gray-800"
              >Censo Demográfico 2022 (IBGE)</a
            >.
          </p>
        </article>
      </div>

      <style>
        /* Colar aqui os estilos */
      </style>
    </div>
  </body>
</html>
